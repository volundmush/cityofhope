@skip isdbref(tag(setr(1,shlocks)))={@assert/inline isdbref(globalroom())=@pemit %#=ERROR: No master room set!;@assert/inline isdbref(setr(0,create(Globally Shared Locks,,t)))=@pemit %#=ERROR: Could not create code object %q1: %q0;@set %q0=INDESTRUCTIBLE !NO_COMMAND;@tag/add %q1=%q0;@tel %q0=globalroom()}

&META_AUTHOR #shlocks=Sponge/#4
&META_PURPOSE #shlocks=Manages locks shared by several coded systems, such as channels, +bb, hangouts, etc
&META_UPDATED_BY #shlocks=Sponge/#4
&UFUN_SHEETLOCK_CAMARILLA #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,faction,camarilla)
&UFUN_SHEETLOCK_INDEPENDENT #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,faction,independent)
&UFUN_SHEETLOCK_GAIAN #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,faction,gaian)
&UFUN_SHEETLOCK_WYRM #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Faction@in@Wyrm|Nephandi|Sabbat)
&UFUN_SHEETLOCK_TRADITIONS #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,faction,traditions)
&UFUN_SHEETLOCK_VAMPIRE #shlocks=corbool(u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@Vampire),u(#dataman/UFUN_SHEET_EXPR,%0,Clan@isnt@&&Domitor@isnt@))
&UFUN_SHEETLOCK_DEMON #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@Demon||Thralled_To@isnt@)
&UFUN_SHEETLOCK_MAGE #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,race,mage)
&UFUN_SHEETLOCK_MORTAL #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,race,mortal)
&UFUN_SHEETLOCK_SHIFTER #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,race,shifter)
&UFUN_SHEETLOCK_MORTAL+ #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@Mortal+)
&UFUN_PASSES_LOCK #shlocks=and(or(isstaff(%0),isapproved(%0)),or(u(UFUN_SHEETLOCK_[%1],%0),member(v(LIST_EXCEPTIONS_[%1]),%0),isstaff(%0)))
&UFUN_SHEETLOCK_WRAITH #shlocks=u(#dataman/UFUN_STR_STAT_MATCH,%0,race,Wraith)
&UFUN_SHEETLOCK_SABBAT #shlocks=u(#dataman/UFUN_SHEETOP,%0,Faction@is@Sabbat)
&UFUN_SHEETLOCK_CHANGELING #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@changeling||Kinain@EEQ@4||Subrace@is@Kinain||Clan@is@Kiasyd)
&UFUN_SHEETLOCK_MEDIUMS #shlocks=u(#dataman/UFUN_ANY_SHEETOP,%0,u(#1336/data_see_wraith))
&UFUN_SHEETLOCK_NEPHANDI #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@Mage&&Faction@in@Nephandi|Wyrm)
&UFUN_SHEETLOCK_TECHNOCRACY #shlocks=u(#dataman/UFUN_SHEETOP,%0,Faction@is@Technocracy)
&UFUN_SHEETLOCK_FERA #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Subrace@in@Ajaba|Ananasi|Bastet|Corax|Nuwisha|Mokole|Kitsune|Ratkin|Rokea|Gurahl||Tribe@in@Ajaba|Ananasi|Bastet|Corax|Nuwisha|Mokole|Kitsune|Ratkin|Rokea|Gurahl|Simba|Ceilican|Bagheera|Balam|Bubasti|Khan|Pumonca|Qualmi|Swara)
&UFUN_SHEETLOCK_SEELIE #shlocks=u(#dataman/UFUN_SHEETOP,%0,Faction@is@Seelie)
&UFUN_SHEETLOCK_UNSEELIE #shlocks=u(#dataman/UFUN_SHEETOP,%0,Faction@is@Unseelie)
&UFUN_SHEETLOCK_GAROU #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Tribe@in@Silver Fang|Bone Gnawer|Silent Strider|Get of Fenris|Red Talon|Black Fury|Glass Walker|Uktena|Wendigo|Shadow Lord|Fianna|Child of Gaia)
&UFUN_SHEETLOCK_BSD #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Tribe@is@Black Spiral Dancer)
&UFUN_SHEETLOCK_STREETWISE #shlocks=u(#dataman/UFUN_SHEETOP,%0,Streetwise@BGT@0)
&UFUN_SHEETLOCK_FALLEN #shlocks=and(u(#dataman/UFUN_SHEETOP,%0,Faction@is@Wyrm),ladd(iter(Race@is@Shifter Subrace@is@Kinfolk Kinfolk_(Merit)@EGTE@1,u(#dataman/UFUN_SHEETOP,%0,##))))
&UFUN_SHEETLOCK_SORC-PSYC #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Subrace@in@Sorcerer|Psychic)
&UFUN_SHEETLOCK_ANARCH #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Faction@is@Anarch)
&UFUN_SHEETLOCK_THRALLS #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Thralled_To@isnt@||Race@is@Demon)
&UFUN_SHEETLOCK_BYGONE #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Race@is@Bygone)
&UFUN_SHEETLOCK_HENGEYOKAI #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Faction@is@Gaian)
&UFUN_SHEETLOCK_LIONSREACH #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,County@is@Lion's Reach)
&UFUN_SHEETLOCK_INTERNET #shlocks= u(#dataman/UFUN_SHEET_EXPR,%0,Computer@BGT@0)
&UFUN_SHEETLOCK_LAW #shlocks=u(#dataman/UFUN_SHEETOP,%0,LawEnforcement@EGT@0)
&UFUN_SHEETLOCK_BASTET #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Subrace@is@Bastet)
&UFUN_SHEETLOCK_GAIAN_FERA #shlocks=and(u(ufun_passes_lock,%0,gaian),u(ufun_passes_lock,%0,fera))
&UFUN_SHEETLOCK_KUEI-JIN #shlocks=u(#dataman/ufun_sheetop,%0,Subrace@is@Kuei-jin)
&UFUN_SHEETLOCK_SHEN #shlocks=u(#dataman/ufun_sheet_expr,%0,Subrace@is@Kuei-jin||Shen@egte@1)
&UFUN_SHEETLOCK_FLIGHT #shlocks=u(#dataman/ufun_sheet_expr,%0,Flight@egt@0||Flight (power)@egt@0||Flight (discipline)@egt@0||Lore of Fundament@egt@0||Forces@egt@2||Wayfare@egt@3||Pilot@egt@0)
&UFUN_SHEETLOCK_CAMARILLA_NOSFERATU #shlocks=u(#dataman/UFUN_SHEET_EXPR,%0,Faction@is@Camarilla&&Clan@is@Nosferatu)